 <!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> {% block title %}Quest Rule Engine{% endblock %} </title>
  <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% block jsTablueLink %}
    
    {% endblock %} 
  <link href="{{ url_for('static', filename='css/styles.min.css') }}" rel="stylesheet" type="text/css">

  {% block CSS_JS %}
    
  {% endblock %} 
</head>

<body>

  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <!--  Main wrapper -->
    <div class="body-wrapper">
        {% block content %}{% endblock %}     
    </div>
  </div>
</body>
<script>
   // Get the select element
   const selectElement = document.getElementById('repayment_term_month');

// Loop from 84 down to 0
for (let i = 84; i >= 1; i--) {
    // Create a new option element
    const option = document.createElement('option');
    // Set the value and text for the option
    option.value = i;
    option.text = i;
    // Append the option to the select element
    selectElement.appendChild(option);
}
const selectElementyear = document.getElementById('asset_manufacture_year');

// Loop from 2024 down to 2000
for (let i = 2024; i >= 2000; i--) {
    // Create a new option element
    const option1 = document.createElement('option');
    // Set the value and text for the option
    option1.value = i;
    option1.text = i;
    // Append the option to the select element
    selectElementyear.appendChild(option1);
}


  fetch("{{ url_for('static', filename='data.json') }}")
  .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
      })
      .then(data => {
          console.log('Data fetched successfully:', data);  // Log to check if the data is fetched correctly

          // Attach event listener to the Asset Category dropdown
        //   const assetCategorySelect = document.getElementById("asset_category");

          // Verify if the event listener is attached
        //   if (assetCategorySelect) {
        //       console.log("Event listener attached to the asset category dropdown.");  // Check if listener is attached
              
            //   assetCategorySelect.addEventListener("change", function() {
            //       console.log("Dropdown value changed.");  // This logs every time the dropdown value is changed
                  
            //       const category = this.value;
                  const assetTypeSelect = document.getElementById("asset_type");

                  // Log the selected category value
                //   console.log("Selected Category:", category);

                  // Clear previous options in the Asset Type dropdown
                  // assetTypeSelect.innerHTML = '<option value="">--Select Type--</option>';

                  // If a valid category is selected, populate the Asset Type dropdown
                //   if (category && data[category]) {
                //       console.log(`Populating Asset Types for ${category}`);  // Log when populating asset types
                      
                      const assetTypes = data.Asset_Type.split(", ");
                      
                      // Populate the Asset Type dropdown
                      assetTypes.forEach(function(assetType) {
                          const option = document.createElement("option");
                          option.value = assetType;
                          option.text = assetType;
                          assetTypeSelect.appendChild(option);
                      });
                      
                      console.log("Asset Type dropdown populated:", assetTypes);
                //   }
            //   });
        //   } else {
        //       console.error("Asset category dropdown not found.");
        //   }
      })
      .catch(error => console.error('Error loading the JSON file:', error));
  </script>
  <!-- <script type="text/javascript">
    $(document).ready(function(){
        // Handle form submission
        $('#loan-form').on('submit', function(event){
            event.preventDefault(); // Prevent default form submission

            // Serialize form data
            var formData = $(this).serialize();

            // Send form data using AJAX
            $.ajax({
                url: '/submit-form',
                type: 'POST',
                data: formData,
                success: function(response) {
                    // Handle the JSON response and display data in the 'right_inner' section
                    
                    var passData = response.Pass;
                    var failData = response.Fail;

                    // Construct table HTML for Pass and Fail results
                    var tableHtml = `
                    <table border="1" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th>Application ID</th>
                                <th>Lender Name</th>
                                <th>Eligibility</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody>`;

                    // Add Pass Data
                    passData.forEach(function(row) {
                        tableHtml += `
                            <tr style="background-color: lightgreen;">
                                <td>${row[0]}</td>
                                <td>${row[1]}</td>
                                <td>${row[2]}</td>
                                <td>${row[3]}</td>
                            </tr>`;
                    });

                    // Add Fail Data
                    failData.forEach(function(row) {
                        tableHtml += `
                            <tr style="background-color: lightcoral;">
                                <td>${row[0]}</td>
                                <td>${row[1]}</td>
                                <td>${row[2]}</td>
                                <td>${row[3]}</td>
                            </tr>`;
                    });

                    tableHtml += `</tbody></table>`;

                    // Inject the table into the 'result-content' div
                    $('#result-content').html(tableHtml);
                },
                error: function(error) {
                    console.error('Error:', error);
                }
            });
        });
    });
</script> -->
    <script type="text/javascript">
    $(document).ready(function(){
        // Handle form submission
        $('#loan-form').on('submit', function(event){
            event.preventDefault(); // Prevent default form submission

            // Serialize form data
            var formData = $(this).serialize();

            // Send form data using AJAX
            $.ajax({
                url: '/submit-form',
                type: 'POST',
                data: formData,
                success: function(response) {
                    // Handle the JSON response and display data in the 'right_inner' section
                    var lenderNames = Object.keys(response)
                    var tableHtml = ` `;
                    var collap = "collapsed"
                    var aria_expanded = "true"
                    lenderNames.forEach(lendername=>{
                        var lenders = Object.keys(response[lendername])
                        
                            
                        const headers = ['asset_type','ABN_in_Months','GST_in_Months','Loan_Amount','applicant_entity_type','MAX_TERM','asset_supplier_type','Max_loan_non_proprty_owners','usage_type','Max_age_of_asset_at_end_of_term','Deposit_for_non_proprty_owner-Primay_assets'];
                        // Construct table HTML for Pass and Fail results
                         tableHtml += `
                        <div class="accordion-item">
                      <h2 class="accordion-header" id="heading${lendername}">
                        <button class="accordion-button ${collap}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${lendername}" aria-expanded=${aria_expanded} aria-controls="collapse${lendername}">
                          ${lendername}
                        </button>
                      </h2>
                      <div id="collapse${lendername}" class="accordion-collapse collapse" aria-labelledby="heading${lendername}" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div class="right_inner">
                                <h1>Quest</h1>
                                <div id="result-content">
                        <table class = "table table-bordered" border="1" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th>Rule Header</th>`;
                        collap = "collapsed"
                        aria_expanded = "false"
                        // Add lender names as table headers
                        lenders.forEach(lender => {
                            if (Object.keys(response[lendername][lender]).length === 0) {
                                return; // Skip this iteration by returning from the callback
                            }
                            var tick = '<span style="color: green;"></span>';
                            if (response[lendername][lender]['Eligibility'] == true){
                                tick = '<span style="color: green;">&#10003;</span>'
                            }
                            tableHtml += `<th>${lender} ${tick}</th>`;
                        });

                        tableHtml += `
                                </tr>
                            </thead>
                            <tbody>`;
                        // Results = Object.values(response)
                        // Add Pass Data
                        headers.forEach(header => {
                                var headvalue = false;
                                lenders.forEach(lender =>{
                                    if(header in response[lendername][lender]){
                                        headvalue = true;
                                    }
                                })
                                if (headvalue == true){
                                    tableHtml += `
                                <tr>
                                <td>${header}</td>  `
                                }
                                
                            
                                
                                lenders.forEach(lender =>{
                                    if(header in response[lendername][lender]){
                                            console.log(response[lendername][lender][header])

                                            if (Object.keys(response[lendername][lender]).length === 0) {
                                                console.log("aaya kya bhai")
                                                return; // Skip this iteration by returning from the callback
                                            }
                                            
                                            console.log("----->",lender)
                                            if (response[lendername][lender][header]['RC_Result'] == true){
                                                color = "lightgreen";
                                            }else{
                                                color = "Red";
                                            }
                                            tableHtml += `
                                            <td style="background-color: ${color}">${response[lendername][lender][header]['Remark']}</td>`
                                        }
                                    else{
                                        tableHtml += `<td> </td>  `
                                        }
                                });
                        
                            
                            tableHtml += `
                                </tr>`;
                        });


                        tableHtml += `</tbody></table> 
                        </div>
                            </div>
                        </div>
                      </div>
                    </div>`;

                        

                        });

                    // Inject the table into the 'result-content' div
                    $('#accordionExample').html(tableHtml);
                },
                error: function(error) {
                    console.error('Error:', error);
                }
            });
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

</html>